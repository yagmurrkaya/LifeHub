<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LifeHub.ViewModels.MoodJournal"
             xmlns:models="clr-namespace:LifeHub.Models.MoodJournal"
             x:Class="LifeHub.Views.MoodJournal.MoodHistoryPage"
             x:DataType="vm:MoodHistoryViewModel"
             Title="Mood Geçmişi"
             BackgroundColor="{AppThemeBinding Light={StaticResource PageBgLight}, Dark={StaticResource PageBgDark}}">

    <CollectionView ItemsSource="{Binding GroupedEntries}" IsGrouped="True">

        <CollectionView.GroupHeaderTemplate>
            <DataTemplate x:DataType="models:MoodGroup">
                <VerticalStackLayout 
                    BackgroundColor="{AppThemeBinding Light={StaticResource PeachBorder}, Dark={StaticResource Gray900}}" 
                    Padding="15,10"> 
                    <Label Text="{Binding DateHeader}" 
                           FontSize="15" 
                           FontAttributes="Bold" 
                           TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"/> 
                </VerticalStackLayout>
            </DataTemplate>
        </CollectionView.GroupHeaderTemplate>

        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="models:MoodEntry">
                <Grid ColumnDefinitions="70, *" Padding="10,0,15,0">
                    
                    <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center">
                        <Label Text="{Binding Date, StringFormat='{0:HH:mm}'}" 
                               FontSize="12" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"  
                               Margin="0,15,0,5"/>
                        <BoxView WidthRequest="2" 
                                 VerticalOptions="FillAndExpand" 
                                 Color="{AppThemeBinding Light={StaticResource PeachBorder}, Dark={StaticResource Gray600}}" 
                                 HorizontalOptions="Center"/>
                    </VerticalStackLayout>

                    <Frame Grid.Column="1" 
                           Margin="0,10,0,10" 
                           Padding="15" 
                           BackgroundColor="{Binding MoodColor}" 
                           HasShadow="False" 
                           CornerRadius="12" 
                           BorderColor="{AppThemeBinding Light={StaticResource PeachBorder}, Dark={StaticResource Gray600}}"> 
                        
                        <VerticalStackLayout Spacing="4">
                            <Label Text="{Binding Mood}" 
                                   FontSize="16" 
                                   FontAttributes="Bold" 
                                   TextColor="#7A2E14"/> 
                            
                            <Label Text="{Binding Note}" 
                                   FontSize="14" 
                                   TextColor="#A65D45"
                                   LineBreakMode="WordWrap"/> 
                        </VerticalStackLayout>
                    </Frame>
                    
                </Grid>
            </DataTemplate>
        </CollectionView.ItemTemplate>
        
    </CollectionView>
</ContentPage>